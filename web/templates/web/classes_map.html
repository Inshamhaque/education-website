{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-6 py-8">
    <h2 class="text-3xl font-semibold text-gray-900 text-center mb-6">ðŸŽ“ Find Educational Opportunities Nearby</h2>

    <!-- Filter Form -->
    <form method="GET" id="filter-form" class="bg-white p-6 shadow-lg rounded-lg flex flex-wrap items-center gap-4 mb-8">
        <div class="flex flex-col">
            <label for="subject" class="text-gray-700 font-medium">Subject</label>
            <select name="subject" id="subject" class="p-2 border rounded-lg shadow-sm">
                <option value="">All</option>
                {% for subject in subjects %}
                <option value="{{ subject.id }}">{{ subject.name }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="flex flex-col">
            <label for="age_group" class="text-gray-700 font-medium">Age Group</label>
            <select name="age_group" id="age_group" class="p-2 border rounded-lg shadow-sm">
                <option value="">All</option>
                {% for value, display in age_groups %}
                <option value="{{ value }}">{{ display }}</option>
                {% endfor %}
            </select>
        </div>

        
        <button type="submit"
            class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg shadow-md hover:bg-blue-700 transition">
            Apply Filters
        </button>
    </form>

    <!-- Map Section -->
    <div class="relative">
        <div id="map" class="w-full h-[500px] rounded-lg shadow-lg border"></div>
    </div>
</div>

<!-- JavaScript for Google Maps & API Fetch -->
<script>
function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 28.7041, lng: 77.1025 }, // Default: Delhi
        zoom: 12,
        styles: [
            { featureType: "water", stylers: [{ color: "#aadaff" }] },
            { featureType: "road", stylers: [{ visibility: "simplified" }] },
            { featureType: "poi", stylers: [{ visibility: "off" }] },
        ],
    });

    fetch("{% url 'map_data_api' %}")
    .then(response => response.json())
    .then(data => {
        data.sessions.forEach(session => {
            var marker = new google.maps.Marker({
                position: { lat: session.lat, lng: session.lng },
                map: map,
                title: session.course_title,
                animation: google.maps.Animation.DROP,
                icon: {
                    url: "https://maps.google.com/mapfiles/ms/icons/blue-dot.png",
                }
            });

            var infoWindow = new google.maps.InfoWindow({
                content: `
                    <div class="p-3">
                        <h4 class="text-lg font-semibold text-blue-600">${session.course_title}</h4>
                        <p class="text-gray-700"><strong>Teacher:</strong> ${session.teacher}</p>
                        <p class="text-gray-600"><strong>Location:</strong> ${session.location}</p>
                        <p class="text-green-600 font-bold">â‚¹${session.price}</p>
                        <a href="${session.url}" class="mt-2 inline-block text-white bg-blue-500 px-3 py-1 rounded-lg shadow hover:bg-blue-600 transition">
                            View Details
                        </a>
                    </div>
                `,
            });

            marker.addListener('click', function() {
                infoWindow.open(map, marker);
            });
        });
    });
}
</script>

<!-- Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA5d9mo7c0Zjpr-2UNnADwoQU24z0o_R_8&callback=initMap" async defer></script>
{% endblock %}
